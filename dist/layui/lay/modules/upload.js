layui.define("layer",function(e){"use strict";var t=layui.jquery,n=layui.layer,r=(layui.device(),"layui-upload-enter"),i="layui-upload-iframe",s={icon:2,shift:6},o={file:"文件",video:"视频",audio:"音频"},u=function(e){this.options=e};u.prototype.init=function(){var e=this,n=e.options,s=t("body"),u=t(n.elem||".layui-upload-file"),f=t('<iframe id="'+i+'" class="'+i+'" name="'+i+'"></iframe>');return t("#"+i)[0]||s.append(f),u.each(function(s,u){u=t(u);var f='<form target="'+i+'" method="'+(n.method||"post")+'" key="set-mine" enctype="multipart/form-data" action="'+(n.url||"")+'"></form>',l=u.attr("lay-type")||n.type;n.unwrap||(f='<div class="layui-box layui-upload-button">'+f+'<span class="layui-upload-icon"><i class="layui-icon">&#xe608;</i>'+(u.attr("lay-title")||n.title||"上传"+(o[l]||"图片"))+"</span></div>"),f=t(f),n.unwrap||f.on("dragover",function(e){e.preventDefault(),t(this).addClass(r)}).on("dragleave",function(){t(this).removeClass(r)}).on("drop",function(){t(this).removeClass(r)}),u.parent("form").attr("target")===i&&(n.unwrap?u.unwrap():(u.parent().next().remove(),u.unwrap().unwrap())),u.wrap(f),u.off("change").on("change",function(){e.action(this,l)})})},u.prototype.action=function(e,r){var o=this,u=o.options,f=e.value,l=t(e),c=l.attr("lay-ext")||u.ext||"";if(f){switch(r){case"file":if(c&&!RegExp("\\w\\.("+c+")$","i").test(escape(f)))return n.msg("不支持该文件格式",s),e.value="";break;case"video":if(!RegExp("\\w\\.("+(c||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(f)))return n.msg("不支持该视频格式",s),e.value="";break;case"audio":if(!RegExp("\\w\\.("+(c||"mp3|wav|mid")+")$","i").test(escape(f)))return n.msg("不支持该音频格式",s),e.value="";break;default:if(!RegExp("\\w\\.("+(c||"jpg|png|gif|bmp|jpeg")+")$","i").test(escape(f)))return n.msg("不支持该图片格式",s),e.value=""}u.before&&u.before(e),l.parent().submit();var h=t("#"+i),p=setInterval(function(){var t;try{t=h.contents().find("body").text()}catch(r){n.msg("上传接口存在跨域",s),clearInterval(p)}if(t){clearInterval(p),h.contents().find("body").html("");try{t=JSON.parse(t)}catch(r){return t={},n.msg("请对上传接口返回JSON字符",s)}"function"==typeof u.success&&u.success(t,e)}},30);e.value=""}},e("upload",function(e){var t=new u(e=e||{});t.init()})});