layui.define(["layer","form"],function(e){"use strict";var t=layui.jquery,n=layui.layer,r=layui.form(),i=(layui.hint(),layui.device()),s="layedit",o="layui-show",u="layui-disabled",a=function(){var e=this;e.index=0,e.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};a.prototype.set=function(e){var n=this;return t.extend(!0,n.config,e),n},a.prototype.on=function(e,t){return layui.onevent(s,e,t)},a.prototype.build=function(e,n){n=n||{};var r=this,s=r.config,u="layui-layedit",a=t("#"+e),l="LAY_layedit_"+ ++r.index,c=a.next("."+u),h=t.extend({},s,n),p=function(){var e=[],t={};return layui.each(h.hideTool,function(e,n){t[n]=!0}),layui.each(h.tool,function(n,r){S[r]&&!t[r]&&e.push(S[r])}),e.join("")}(),d=t(['<div class="'+u+'">','<div class="layui-unselect layui-layedit-tool">'+p+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+l+'" name="'+l+'" textarea="'+e+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));return i.ie&&i.ie<8?a.removeClass("layui-hide").addClass(o):(c[0]&&c.remove(),f.call(r,d,a[0],h),a.addClass("layui-hide").after(d),r.index)},a.prototype.getContent=function(e){var t=l(e);if(t[0])return c(t[0].document.body.innerHTML)},a.prototype.getText=function(e){var n=l(e);if(n[0])return t(n[0].document.body).text()},a.prototype.sync=function(e){var n=l(e);if(n[0]){var r=t("#"+n[1].attr("textarea"));r.val(c(n[0].document.body.innerHTML))}},a.prototype.getSelection=function(e){var t=l(e);if(t[0]){var n=d(t[0].document);return document.selection?n.text:n.toString()}};var f=function(e,n,r){var i=this,s=e.find("iframe");s.css({height:r.height}).on("load",function(){var o=s.contents(),u=s.prop("contentWindow"),a=o.find("head"),f=t(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),l=o.find("body");a.append(f),l.attr("contenteditable","true").css({"min-height":r.height}).html(n.value||""),h.apply(i,[u,s,n,r]),y.call(i,u,e,r)})},l=function(e){var n=t("#LAY_layedit_"+e),r=n.prop("contentWindow");return[r,n]},c=function(e){return 8==i.ie&&(e=e.replace(/<.+>/g,function(e){return e.toLowerCase()})),e},h=function(e,r,s,o){var u=e.document,a=t(u.body);a.on("keydown",function(e){var t=e.keyCode;if(13===t){var r=d(u),i=v(r),s=i.parentNode;if("pre"===s.tagName.toLowerCase()){if(e.shiftKey)return;return n.msg("请暂时用shift+enter"),!1}u.execCommand("formatBlock",!1,"<p>")}}),t(s).parents("form").on("submit",function(){var e=a.html();8==i.ie&&(e=e.replace(/<.+>/g,function(e){return e.toLowerCase()})),s.value=e}),a.on("paste",function(t){u.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){p.call(e,a),s.value=a.html()},100)})},p=function(e){var n=this;n.document,e.find("*[style]").each(function(){var e=this.style.textAlign;this.removeAttribute("style"),t(this).css({"text-align":e||""})}),e.find("table").addClass("layui-table"),e.find("script,link").remove()},d=function(e){return e.selection?e.selection.createRange():e.getSelection().getRangeAt(0)},v=function(e){return e.endContainer||e.parentElement().childNodes[0]},m=function(e,n,r){var i=this.document,s=document.createElement(e);for(var o in n)s.setAttribute(o,n[o]);if(s.removeAttribute("text"),i.selection){var u=r.text||n.text;if("a"===e&&!u)return;u&&(s.innerHTML=u),r.pasteHTML(t(s).prop("outerHTML")),r.select()}else{var u=r.toString()||n.text;if("a"===e&&!u)return;u&&(s.innerHTML=u),r.deleteContents(),r.insertNode(s)}},g=function(e,n){var r=this.document,i="layedit-tool-active",s=v(d(r)),o=function(t){return e.find(".layedit-tool-"+t)};n&&n[n.hasClass(i)?"removeClass":"addClass"](i),e.find(">i").removeClass(i),o("unlink").addClass(u),t(s).parents().each(function(){var e=this.tagName.toLowerCase(),t=this.style.textAlign;"b"!==e&&"strong"!==e||o("b").addClass(i),"i"!==e&&"em"!==e||o("i").addClass(i),"u"===e&&o("u").addClass(i),"strike"===e&&o("d").addClass(i),"p"===e&&("center"===t?o("center").addClass(i):"right"===t?o("right").addClass(i):o("left").addClass(i)),"a"===e&&(o("link").addClass(i),o("unlink").removeClass(u))})},y=function(e,r,i){var s=e.document,o=t(s.body),a={link:function(n){var r=v(n),i=t(r).parent();b.call(o,{href:i.attr("href"),target:i.attr("target")},function(t){var r=i[0];"A"===r.tagName?r.href=t.url:m.call(e,"a",{target:t.target,href:t.url,text:t.url},n)})},unlink:function(e){s.execCommand("unlink")},face:function(t){w.call(this,function(n){m.call(e,"img",{src:n.src,alt:n.alt},t)})},image:function(r){var s=this;layui.use("upload",function(o){var u=i.uploadImage||{};o({url:u.url,method:u.type,elem:t(s).find("input")[0],unwrap:!0,success:function(t){0==t.code?(t.data=t.data||{},m.call(e,"img",{src:t.data.src,alt:t.data.title},r)):n.msg(t.msg||"上传失败")}})})},code:function(t){E.call(o,function(n){m.call(e,"pre",{text:n.code,"lay-lang":n.lang},t)})},help:function(){n.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:!0,shade:.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},f=r.find(".layui-layedit-tool"),l=function(){var n=t(this),r=n.attr("layedit-event"),i=n.attr("lay-command");if(!n.hasClass(u)){o.focus();var l=d(s);l.commonAncestorContainer,i?(s.execCommand(i),/justifyLeft|justifyCenter|justifyRight/.test(i)&&s.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){o.focus()},10)):a[r]&&a[r].call(this,l),g.call(e,f,n)}},c=/image/;f.find(">i").on("mousedown",function(){var e=t(this),n=e.attr("layedit-event");c.test(n)||l.call(this)}).on("click",function(){var e=t(this),n=e.attr("layedit-event");c.test(n)&&l.call(this)}),o.on("click",function(){g.call(e,f),n.close(w.index)})},b=function(e,t){var i=this,s=n.open({type:1,id:"LAY_layedit_link",area:"350px",shade:.05,shadeClose:!0,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(e.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+("_self"!==e.target&&e.target?"":"checked")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+("_blank"===e.target?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(e,s){var o="submit(layedit-link-yes)";r.render("radio"),e.find(".layui-btn-primary").on("click",function(){n.close(s),i.focus()}),r.on(o,function(e){n.close(b.index),t&&t(e.field)})}});b.index=s},w=function(e){var r=function(){var e=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],t={};return layui.each(e,function(e,n){t[n]=layui.cache.dir+"images/face/"+e+".gif"}),t}();return w.hide=w.hide||function(e){"face"!==t(e.target).attr("layedit-event")&&n.close(w.index)},w.index=n.tips(function(){var e=[];return layui.each(r,function(t,n){e.push('<li title="'+t+'"><img src="'+n+'" alt="'+t+'"></li>')}),'<ul class="layui-clear">'+e.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(i,s){i.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){e&&e({src:r[this.title],alt:this.title}),n.close(s)}),t(document).off("click",w.hide).on("click",w.hide)}})},E=function(e){var t=this,i=n.open({type:1,id:"LAY_layedit_code",area:"550px",shade:.05,shadeClose:!0,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">请选择语言</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">代码</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(i,s){var o="submit(layedit-code-yes)";r.render("select"),i.find(".layui-btn-primary").on("click",function(){n.close(s),t.focus()}),r.on(o,function(t){n.close(E.index),e&&e(t.field)})}});E.index=i},S={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;</i>'},x=new a;e(s,x)});